<html>
<head>
<script>var isomorphicDir="/isomorphic/";</script>
<script src="/isomorphic/system/modules/ISC_Core.js"></script>
<script src="/isomorphic/system/modules/ISC_Foundation.js"></script>
<script src="/isomorphic/system/modules/ISC_Containers.js"></script>
<script src="/isomorphic/system/modules/ISC_Grids.js"></script>
<script src="/isomorphic/system/modules/ISC_Forms.js"></script>
<script src="/isomorphic/system/modules/ISC_DataBinding.js"></script>
<script src="/isomorphic/skins/TreeFrog/load_skin.js"></script>
<style type="text/css">
.cssButton {
    
    font-family:Verdana,Bitstream Vera Sans,sans-serif; font-size:11px; 
    color:#000000;
    background-image:none;
}
.cssButtonOver,
.cssButtonFocusedOver,
.cssButtonFocused  {
  	 font-family:Verdana,Bitstream Vera Sans,sans-serif; font-size:11px; 
    color:#000000;
}
.cssButtonDown,
.cssButtonFocusedDown {
    font-family:Verdana,Bitstream Vera Sans,sans-serif; font-size:11px;
/*background-color:green;*/
    color:#000000;
}
.myMenuButton {
    
    font-family:Verdana,Bitstream Vera Sans,sans-serif; font-size:11px; 
    color:#000000;
    background-image:none;
}
.myMenuButtonOver,
.myMenuButtonFocusedOver,
.myMenuButtonFocused {
  	 font-family:Verdana,Bitstream Vera Sans,sans-serif; font-size:11px;background-color:#E0E0E0;
 border-top:1px solid #CCCCCC;
 border-bottom:1px solid #CCCCCC; 
    color:#000000;
}
.myMenuButtonDown,
.myMenuButtonFocusedDown {
    font-family:Verdana,Bitstream Vera Sans,sans-serif; font-size:11px;
background-color:#E0E0E0;
    color:#000000;
}
</style>
</head>
<body>
<script> 
isc.RestDataSource.create({
    ID:"domains",
    dataFormat:"json",
    dataURL:"ds-domains.php",
    transformResponse : function (dsResponse, dsRequest, data) {        
    		var dsResponse = this.Super("transformResponse", arguments);
		for (i=0; i<dsResponse.totalRows; i++)
		{
			if (dsResponse.data[i].enable_ftp!=true) 
				dsResponse.data[i].ftp = "[SKIN]/actions/remove.png";
			else dsResponse.data[i].ftp = "[SKIN]/actions/approve.png";
                     	if (dsResponse.data[i].enable_mail!=true)
				dsResponse.data[i].mail = "[SKIN]/actions/remove.png";
			else dsResponse.data[i].mail = "[SKIN]/actions/approve.png";
			//if (dsResponse.data[i].enable_mail!=true)
				dsResponse.data[i].web = "[SKIN]/actions/remove.png";
			//else dsResponse.data[i].mail = "[SKIN]/actions/approve.png";
			dsResponse.data[i].dns = "[SKIN]/actions/remove.png";
		}
     		return dsResponse;
		},
    fields:[
        {type: "sequence", name: "domain_id", primaryKey: true},
	{name: "domain_id"},
        {title:"Domain", name:"domain", type: "text",  required: true},
	{name: "web", title: "Web", align:"center",  width:100, type:"image", canFilter:false},
	{name: "enable_web", type:"checkbox"},   
	{name: "enable_dns", type:"checkbox"},     
	{name: "enable_ftp", type:"checkbox"},
	{name: "ftp", title: "FTP", align:"center",  width:100, type:"image", canFilter:false},
        {name: "dns", title: "DNS", align:"center",  width:100, type:"image", canFilter:false},
        {name: "enable_mail", type:"checkbox"},
	{name: "mail", title: "Mail", align:"center",  width:100, type:"image", canFilter:false},
	{name: "site_id"},
	{name: "mail_gid"},
	{name: "mail_uid"},
	{name: "username"},
	{name:"nr_mailboxes"},
	{name:"nr_aliases"}
    ],
    operationBindings:[
       {operationType:"fetch", dataProtocol:"postMessage"},
       {operationType:"add", dataProtocol:"postMessage"},
       {operationType:"remove", dataProtocol:"postMessage"},
       {operationType:"update", dataProtocol:"postMessage"}
    ],
}); 

isc.RestDataSource.create({
    ID:"mailboxes",
    dataFormat:"json",
    dataURL:"ds-mailboxes.php",
    fields:[
        {type: "sequence", name: "mailbox_id", primaryKey: true},
	{name: "mailbox_id"},
	{name: "domain_id"},
	{name: "domain"},
        {title:"Mailbox", name:"mailbox", type: "text",  required: true},
	{name: "addressmail"},
	{name: "copy_on_forward",type:"checkbox"}
    ],
    operationBindings:[
       {operationType:"fetch", dataProtocol:"postMessage"},
       {operationType:"add", dataProtocol:"postMessage"},
       {operationType:"remove", dataProtocol:"postMessage"},
       {operationType:"update", dataProtocol:"postMessage"}
    ],
});

isc.RestDataSource.create({
    ID:"forwards",
    dataFormat:"json",
    dataURL:"ds-forwards.php",
    fields:[
        {type: "sequence", name: "mailbox_forward_id", primaryKey: true},
	{name: "mailbox_forward_id"},
	{name: "mailbox_id"},
	{name: "address",align:"center"}
    ],
    operationBindings:[
       {operationType:"fetch", dataProtocol:"postMessage"},
       {operationType:"add", dataProtocol:"postMessage"},
       {operationType:"remove", dataProtocol:"postMessage"},
       {operationType:"update", dataProtocol:"postMessage"}
    ],
});

isc.RestDataSource.create({
    ID:"aliases",
    dataFormat:"json",
    dataURL:"ds-aliases.php",
    fields:[
        {type: "sequence", name: "global_mail_alias_id", primaryKey: true},
	{name: "global_mail_alias_id"},
	{name: "domain_id"},
        {name:"name", type: "text",  required: true},
	{name: "addressalias", align:"center", canFilter:false}
    ],
    operationBindings:[
       {operationType:"fetch", dataProtocol:"postMessage"},
       {operationType:"add", dataProtocol:"postMessage"},
       {operationType:"remove", dataProtocol:"postMessage"},
       {operationType:"update", dataProtocol:"postMessage"}
    ],
});

isc.RestDataSource.create({
    ID:"aliasesto",
    dataFormat:"json",
    dataURL:"ds-aliasesto.php",
    fields:[
        {type: "sequence", name: "global_mail_alias_to_id", primaryKey: true},
	{name: "global_mail_alias_to_id"},
	{name: "global_mail_alias_id"},
	{name: "address",align:"center"}
    ],
    operationBindings:[
       {operationType:"fetch", dataProtocol:"postMessage"},
       {operationType:"add", dataProtocol:"postMessage"},
       {operationType:"remove", dataProtocol:"postMessage"},
       {operationType:"update", dataProtocol:"postMessage"}
    ],
});
isc.RestDataSource.create({
    ID:"users",
    dataFormat:"json",
    dataURL:"ds-users.php",
    fields:[
        {type: "sequence", name: "user_id", primaryKey: true},
	{name: "user_id"},
	{name: "parent_id"},
	{name: "username"},
	{name: "password"}
    ],
    operationBindings:[
       {operationType:"fetch", dataProtocol:"postMessage"},
       {operationType:"add", dataProtocol:"postMessage"},
       {operationType:"remove", dataProtocol:"postMessage"},
       {operationType:"update", dataProtocol:"postMessage"}
    ],
});

isc.RestDataSource.create({
    ID:"sites",
    dataFormat:"json",
    dataURL:"ds-sites.php",
    fields:[
        {type: "sequence", name: "site_id", primaryKey: true},
	{name: "site_id"},
	{name: "name"},
	{name: "server_id"},
	{name: "server_port"},
	{name: "enabled"}
    ],
    operationBindings:[
       {operationType:"fetch", dataProtocol:"postMessage"},
       {operationType:"add", dataProtocol:"postMessage"},
       {operationType:"remove", dataProtocol:"postMessage"},
       {operationType:"update", dataProtocol:"postMessage"}
    ],
});

isc.ClassFactory.defineClass("TabsPanel", isc.VLayout);

isc.TabsPanel.addProperties({
	width: "80%",
	height: "100%",
	align:"center",
	initWidget: function() {
		this.Super("initWidget", arguments);
	
		this.listGrid = isc.ListGrid.create({
			ID: "listGrid",
			container: this,
			width: "100%",
			height:"30%",
			alternateRecordStyles:true,
			dataSource: isc.DS.get("domains"),
			autoFetchData: true,
			showResizeBar: true,
			recordClick: function (viewer, record){
				stack1.setSectionTitle(2,record.domain.toUpperCase());
				stack1.showSection(2);
				this.container.loadRecord(record);
				mailboxForm.clearErrors(true);
				fwForm.clearErrors(true);
				aliasForm.clearErrors(true);
				aliasToForm.clearErrors(true);
				//pentru a pastra numele domeniului 
				enableMail.editRecord(record);
				enableFtp.editRecord(record);
				enableWebService.editRecord(record);
				summary.show();
				formLayout.hide();
				wizardV.hide();
				tabWeb.hide();
				tabFTP.hide();
				tabMail.hide();
				this.container.setLabelContents(record);
			},
				fields: [
					{name: "domain", title: "Domain",required:"true"},
					{name: "web", title: "Web", align:"center",  width:100, type:"image", canFilter:false},
		      			{name: "ftp", title: "FTP", align:"center",  width:100, type:"image",canFilter:false},
                       			{name: "dns", title: "DNS", align:"center",  width:100, type:"image", canFilter:false},
                       			{name: "mail", title: "Mail", align:"center",  width:100, type:"image",canFilter:false}
					],  
		  		autoFitData: "vertical",
		  		showFilterEditor: true,
		  		autoFitMaxRecords: 10
		});

		this.TabMailboxes=isc.TabMailboxes.create();
		this.TabAliases=isc.TabAliases.create();
		this.TabFTPSett=isc.TabFTPSett.create();
		this.TabWebDomain=isc.TabWebDomain.create();

		this.tabWeb=isc.TabSet.create({
                        ID:"tabWeb",
			visibility:"hidden",
			container:this,
			tabs:[	
				{title:"Settings", pane:this.TabWebDomain, ID:"settWebTab"}//,<-----Versiuni viitoare
				/*{title:"VHOSTS", pane:label2, ID:"vhostWebTab"},
				{title:"Statistics", pane:label3, ID:"statWebTab"},
				{title:"Logs", pane:label4, ID:"logsWebTab"}*/
			]
              	});

		this.tabMail=isc.TabSet.create({
			ID:"tabMail",
			visibility:"hidden",
			
			container:this,
			tabs:[
				{title:"Mailboxes", pane:this.TabMailboxes, ID:"mailboxMailTab"},
				{title:"Global Aliases", pane:this.TabAliases, ID:"fwMailTab"}/*, <-----Versiuni viitoare
				{title:"Catch-all", pane:label10, ID:"catchMailTab"},
				{title:"Auto-Reply", pane:label11, ID:"autoMailTab"},
				{title:"Logs", pane:label12, ID:"logsMailTab"}*/
			]
		});

		this.tabFTP=isc.TabSet.create({
			ID:"tabFTP",
			visibility:"hidden",
			container:this,
			tabs:[
				{title:"Settings", pane:this.TabFTPSett, ID:"settFTPTab"}/*,<------ Versiuni viitoare
				{title:"SmartAuth", pane:label6, ID:"smartFTPTab"},
				{title:"Logs", pane:label7, ID:"logsFTPTab"}*/
			]
		});
		
		this.label1=isc.Label.create({
			ID:"label1",
			autoDraw: false,
			width:"100%",
			height:10,
			icon:"[SKIN]/actions/approve.png",
			//align:"center",
		   	contents:"Web service is <span style='color:red;font-weight:bold'>not enabled </span>"
		});
		this.label1Button=isc.Button.create({
			title:"[ configure...]",
			width:70,
			height:12,
			baseStyle: "cssButton",
			click: function() 
				{
					summary.hide();
					unconfigV.show();
				}		
		});
		
		this.webservice=isc.HLayout.create({
			width:240,
			height:10,
			members:[this.label1,this.label1Button]		
		});
		this.label2=isc.Label.create({
			ID:"label2",
			autoDraw: false,
			width:"100%",
			height:10,
			icon:"[SKIN]/actions/approve.png",
		   	contents:"Web access is <span style='color:red;font-weight:bold'>not enabled </span>"
		});
		this.label2Button=isc.Button.create({
			title:"[ configure...]",
			width:70,
			height:12,
			baseStyle: "cssButton",
			click: function() 
				{
					summary.hide();
					configV.show();
				}		
		});
		
		this.webaccess=isc.HLayout.create({
			width:240,
			height:10,
			members:[this.label2,this.label2Button]		
		});
		this.label3=isc.Label.create({
			ID:"label3",
			autoDraw: false,
			width:"100%",
			height:10,
			icon:"[SKIN]/actions/approve.png",
			//align:"center",
		   	contents:"Web server is <span style='color:red;font-weight:bold'>stopped </span>"
		});
		
		this.label23V=isc.VLayout.create({
		    	layoutLeftMargin: 50,
			height:40,
		    	membersMargin: 10,
		    	members: [this.webaccess,this.label3]
		});

		this.label4=isc.Label.create({
			ID:"label4",
			autoDraw: false,
			width:"100%",
			height:10,
			icon:"[SKIN]/actions/approve.png",
			//align:"center",
		   	contents:"FTP service is <span style='color:red;font-weight:bold'>not enabled </span>"
		});
		this.label4Button=isc.Button.create({
			title:"[ configure...]",
			width:70,
			height:12,
			baseStyle: "cssButton",
			click: function() 
				{
					summary.hide();
					tabFTP.show();
				}		
		});
		
		this.ftp=isc.HLayout.create({
			width:240,
			height:10,
			members:[this.label4,this.label4Button]		
		});	
		this.label5=isc.Label.create({
			ID:"label5",
			autoDraw: false,
			width:"100%",
			height:10,
			icon:"[SKIN]/actions/approve.png",
		   	contents:"Mail service is <span style='color:red;font-weight:bold'>not enabled </span>"
		});
		this.label5Button=isc.Button.create({
			title:"[ configure...]",
			width:70,
			height:12,
			baseStyle: "cssButton",
			click: function() 
				{
					summary.hide();
					tabMail.show();
				}		
		});
		
		this.mail=isc.HLayout.create({
			width:240,
			height:10,
			members:[this.label5,this.label5Button]		
		});

		this.label6=isc.Label.create({
			ID:"label6",
			autoDraw: false,
			width:"100%",
			height:10,
		   	contents:"x Mailboxes"
		});
		this.label7=isc.Label.create({
			ID:"label7",
			autoDraw: false,
			width:"100%",
			height:10,
		   	contents:"y Global Aliases"
		});
		this.label67V=isc.VLayout.create({
		    	layoutLeftMargin: 50,
			height:40,
			visibility:"hidden",
		    	membersMargin: 10,
		    	members: [this.label6,this.label7]
		});
		this.label8=isc.Label.create({
			ID:"label8",
			autoDraw: false,
			width:"100%",
			height:10,
			icon:"[SKIN]/actions/approve.png",
		   	contents:"DNS service is <span style='color:red;font-weight:bold'>not enabled </span>"
		});

		this.summary=isc.VLayout.create({
			ID:"summary",
			visibility:"hidden",
			layoutLeftMargin:80,
			layoutTopMargin:50,
			membersMargin:15,
			members:[this.webservice,this.label23V,this.ftp,this.mail,this.label67V,this.label8]
		});
		this.dynamForm=isc.DynamicForm.create({
			ID:"dynamForm",
			container: this,
			dataSource: isc.DS.get("domains"),
			autoDraw: false,
			height: 48,
		       	padding:4,
			fields: [
			{name: "domain", type: "text", title: "Domain",required:"true"}
			]
		});
	
		this.saveButton = isc.IButton.create({
			container: this,
			title: "Save",
			icon: "[SKIN]/actions/save.png",
			click: 
			function () 
				{this.container.saveRecord();}
		});

		this.formLayout=isc.VLayout.create({
			ID:"formLayout",
			width:300,
			height:200,
			padding:50,
			align:"center",
			visibility:"hidden",
			members: [this.dynamForm, this.saveButton]
		});
		this.wizardForm=isc.DynamicForm.create({
			ID:"wizardForm",
			width:50,
			container: this,
			fields: [
			{name: "domain", type: "text", title: "Name",required:"true"}]
		});
		this.label=isc.HTMLFlow.create({
		    ID:"statusReport",
		    contents :"Select services to setup & enable " 
		 
		});
		this.wizardForm2=isc.DynamicForm.create({
			ID:"wizardForm2",
			container: this,
			fields: [			
			{name: "enable_web", type: "checkbox", title: "Web"},
			{name: "enable_ftp", type: "checkbox", title: "FTP"},
			{name: "enable_mail", type: "checkbox", title: "Mail"},
			{name: "enable_dns", type: "checkbox", title: "DNS"},
			]
		});
		this.valuesmanager_wizardForm=isc.ValuesManager.create({
			ID:"valuesmanager_wizardForm",
			container:this,
			dataSource: isc.DS.get("domains"),
			members:[this.wizardForm,this.wizardForm2]		
		});
		this.createButton = isc.IButton.create({
			container: this,
			title: "Create Domain",
			width:150,
			icon: "[SKIN]/actions/approve.png",
			click: 
			function () 
				{this.container.createDomain();}
		});
		this.wizardV=isc.VLayout.create({
			ID:"wizardV",
			visibility:"hidden",
			membersMargin:10,
			layoutLeftMargin:30,
			layoutTopMargin:30,
			members:[this.wizardForm,this.label, this.wizardForm2,this.createButton]	
		});
		this.hLayout=isc.HLayout.create({
			ID:"hLayout",
			width:"100%",
			height:"70%",
			border:"1px solid gray",
			members: [this.tabWeb,this.tabMail, this.tabFTP,this.formLayout,this.summary,this.wizardV]
		});	
		
		this.addMember(this.listGrid);
		this.addMember(this.hLayout);
	},
	loadRecord: function(record) {
		this.TabMailboxes.setDomainId(record.domain_id);
		this.TabAliases.setDomainId(record.domain_id);
		this.TabWebDomain.setDomainId(record.domain_id);
		this.TabWebDomain.setSiteId(record.site_id);
		//ptr refresh listGrid
		this.TabMailboxes.setMailboxId(0);
		this.TabAliases.setAliasId(0);
		valuesManager.editNewRecord(record);
		aliasForm.editNewRecord(record);
	},
	setLabelContents: function(record){
		if (record.site_id!='') this.label1.setContents("Web service is <span style='color:green;font-weight:bold'>enabled </span>");
		else this.label1.setContents("Web service is <span style='color:red;font-weight:bold'>not enabled </span>");
		if (record.enable_ftp==true) this.label4.setContents("FTP service is <span style='color:green;font-weight:bold'>enabled </span>");	
		else this.label4.setContents("FTP service is <span style='color:red;font-weight:bold'>not enabled </span>");		
		if (record.enable_mail==true) 
		{
			this.label5.setContents("Mail service is <span style='color:green;font-weight:bold'>enabled </span>");
			this.label67V.show();	
			this.label6.setContents(record.nr_mailboxes+" Mailboxes");
			this.label7.setContents(record.nr_aliases+" Global Aliases");
		}
		else
		{	
			this.label5.setContents("Mail service is <span style='color:red;font-weight:bold'>not enabled </span>");
			this.label67V.hide();	
			//this.label6.setContents(record.nr_mailboxes+" Mailboxes");
			//this.label7.setContents(record.nr_aliases+" Global Aliases");
		}
	},
	saveRecord: function() {
		this.dynamForm.saveData(function(dsResponse, data, dsRequest) {
			if (dsResponse.status != 0)
				return;
			if (!this.isNewRecord())
				return;
			this.setSaveOperationType("update"); 
		});
	this.dynamForm.editNewRecord();
	},
	createDomain: function() {
		this.valuesmanager_wizardForm.saveData(function(dsResponse, data, dsRequest) {
			if (dsResponse.status != 0)
				return;
			if (!this.isNewRecord())
				return;
			this.setSaveOperationType("update"); 
		});
	this.valuesmanager_wizardForm.editNewRecord();
	}

});
isc.ClassFactory.defineClass("TabWebDomain", isc.VLayout);

isc.TabWebDomain.addProperties({
	width: "100%",
	height: "100%",
	align:"center",
	showResizeBar:false,
	initWidget: function() {
		this.Super("initWidget", arguments);
		this.label_unconf=isc.Label.create({
			ID:"label_unconf",
			autoDraw: false,
			width:"100%",
			//height:"50%",
			align:"center",
		   	contents:"Web service for this domain is not configured. Click below to configure ..."
		});
		this.enableWebService=isc.DynamicForm.create({
   			ID: "enableWebService",
    			dataSource: isc.DS.get("domains"),
			fields: [
				{name: "domain_id",showIf:"false"},
				{name: "domain",showIf:"false"},
				{name: "site_id",type:"textbox",showIf:"false"}
				]
		});

		this.enableWebAcces=isc.DynamicForm.create({
   			ID: "enableWebAcces",
    			dataSource: isc.DS.get("sites"),
			fields: [
				{name: "enabled",type:"checkbox", title:"Enable web access"}
				]
		});

		this.configButton=isc.IButton.create({
			ID:"configButton",
			container: this,
			title: "Enable Web Service",
			width:150,
			icon: "[SKIN]/actions/approve.png",
			click: function () {this.container.saveconfigWeb();}
		});
		this.unconfigButtonV=isc.VLayout.create({
			container:this,
			align:"center",
			width:"50%",
			height:"100%",
			layoutLeftMargin:400,
			members:[this.enableWebService,this.configButton]		
		});

		this.unconfigV=isc.VLayout.create({
			ID:"unconfigV",
			container:this,
			visibility:"hidden",
			align:"center",
			members:[this.label_unconf,this.unconfigButtonV]		
		});

		
		this.configV=isc.VLayout.create({
			ID:"configV",
			container:this,
			visibility:"hidden",
			layoutTopMargin:100,
			align:"center",
			members:[this.enableWebAcces]		
		});

		this.addMember(this.configV);
		this.addMember(this.unconfigV);

		this.loadinit();
	},
	loadinit: function ()
	{
		if (this.siteId!=null) this.configV.show(); else this.unconfigV.show();
	},
	setSiteId: function(siteId) {
		this.siteId = siteId;
		//this.listGrid_Mailboxes.fetchData({domain_id: domainId});
		
	},
	setDomainId: function(domainId) {
		this.domainId = domainId;
		//this.listGrid_Mailboxes.fetchData({domain_id: domainId});
	},
	saveconfigWeb: function()
	{ 
		this.enableWebService.saveData(function(dsResponse, data, dsRequest) {
			if (dsResponse.status != 0)
				return;
			if (!this.isNewRecord())
				return;
			this.setSaveOperationType("update");
		});
	},
	domainId:null,
	siteId:null
});

isc.ClassFactory.defineClass("TabMailboxes", isc.VLayout);

isc.TabMailboxes.addProperties({
	width: "100%",
	height: "100%",
	align:"center",
	showResizeBar:false,
	initWidget: function() {
		this.Super("initWidget", arguments);
		this.listGrid_Mailboxes=isc.ListGrid.create({
			ID:"listGrid_Mailboxes",
			container:this,
			width:"100%",
			height:"100%",
			alternateRecordStyles:true,
			dataSource: isc.DS.get("mailboxes"),
			autoFetchData: false,
			showResizeBar: false,
			recordClick: function (viewer, record){
				this.container.deleteButton.setDisabled(false);
				this.container.saveButton.setDisabled(false);
				this.container.tabset_Mailboxes.show();
				this.container.valuesManager.editRecord(record);
				this.container.loadFwRecord(record);
				aliasForm.clearErrors(true);
				aliasToForm.clearErrors(true);
				this.container.addButton.setDisabled(false);
			},
			fields: [
				{name: "domain_id",showIf:"false"},
				{name: "mailbox_id",showIf:"false"},
				{name: "mailbox", title: "Mailbox",required:"true",canEdit:false},
				{name: "addressmail", title: "Address", align:"center",canFilter:false,canEdit:false}
				],  
		  	autoFitData: "vertical",
		  	showFilterEditor: false,
		  	autoFitMaxRecords: 10
		});
		this.enableMail=isc.DynamicForm.create({
			ID:"enableMail",
			container: this,
			height:20,
			dataSource: isc.DS.get("domains"),
			fields:[
				{name: "enable_mail", type: "checkbox", title: "Enable local mail delivery"}
			]
		});
		this.applyButton=isc.IButton.create({
			container: this,
			width:110,
			title: "Apply",
			icon: "[SKIN]/actions/approve.png",
			click: function () {
			       this.container.saveApplyRecord();
			}
		});
		this.enableMailH=isc.HLayout.create({
			showResizeBar:false,
			layoutLeftMargin:20,
			layoutTopMargin:20,
			width:"80%",
			height:20,
			membersMargin:500,
			members: [this.enableMail, this.applyButton]
		});
		this.mailboxForm=isc.DynamicForm.create({
			ID:"mailboxForm",
			width:"100%",
			height:"100%",
			align:"center",
			layoutTopMargin:30,
			container: this,
			dataSource: isc.DS.get("mailboxes"),
			fields: [
				{name: "mailbox", type: "text", title: "Mailbox",required:"true"},
				{name: "password", type: "text", title: "Password",required:"true"}
			]
		});
		this.mailboxFormH=isc.HLayout.create({
			layoutTopMargin:30,
			members:[this.mailboxForm]
		});
		this.newButton = isc.IButton.create({
			container: this,
			width:110,
			title: "New Mailbox",
			icon: "[SKIN]/actions/add.png",
			showDisabledIcon: false,
			click: function ()
				{
					this.container.newRecord();
					this.container.mailboxForm.clearErrors(true);
					this.container.tabset_Mailboxes.show();
					this.container.saveButton.setDisabled(false);
					this.container.listGrid_Mailboxes.deselectAllRecords();
					this.container.setMailboxId(0);
					this.container.addButton.setDisabled(true);
				}
		});
		
		this.saveButton = isc.IButton.create({
			container: this,
			width:110,
			title: "Save",
			icon: "[SKIN]/actions/save.png",
			//showDisabledIcon: "[SKIN]/actions/save.png",
			click: function () {this.container.saveRecord();},
			disabled: true
		});
		
		this.deleteButton = isc.IButton.create({
			container: this,
			width:110,
			title: "Delete",
			icon: "[SKIN]/TabSet/close.png",
			showDisabledIcon: "[SKIN]/TabSet/close_Disabled.png",
			disabled: true,
			click: "this.container.deleteRecord();"
		});
		
		this.toolbar = isc.VLayout.create({
			
			members: [this.newButton, this.saveButton, this.deleteButton]
		});

		this.tabH=isc.HLayout.create({
			showResizeBar:true,
			layoutLeftMargin:30,
			layoutTopMargin:10,
			membersMargin:10,
			width:"80%",
			height:"30%",
			members: [this.listGrid_Mailboxes, this.toolbar]
		});
		
		this.listGrid_FwMailboxes=isc.ListGrid.create({
			ID:"listGrid_FwMailboxes",
			container:this,
			width:"100%",
			alternateRecordStyles:true,
			dataSource: isc.DS.get("forwards"),
			autoFetchData: false,
			showResizeBar: false,
			recordClick: function (viewer, record){
				this.container.removeButton.setDisabled(false);
				this.container.addButton.setDisabled(false);
			},
				fields: [
					{name: "address", title: "Address", align:"center"}
					],  
		  		autoFitData: "vertical",
		  		autoFitMaxRecords: 5
		});
		this.fwForm=isc.DynamicForm.create({
			ID:"fwForm",
			container: this,
			dataSource: isc.DS.get("forwards"),
			fields: [
				{name: "address", type: "text", required:"true"}]
		});
		this.fwCheckForm=isc.DynamicForm.create({
			ID:"fwCheckForm",
			container: this,
			align:"left",
			width:50,
			height:20,
			dataSource: isc.DS.get("mailboxes"),
			fields: [
				{name: "copy_on_forward", type: "checkbox", title:"Also leap a local copy"}
			]
		});
		
		this.valuesManager = isc.ValuesManager.create({
			ID:"valuesManager",
			layoutLeftMargin:30,
			container: this,
			dataSource: isc.DS.get("mailboxes"),
			members: [
				this.mailboxForm,
				this.fwCheckForm
			]
		});
		
		this.addButton = isc.IButton.create({
			container: this,
			title: "Add",
			disabled:false,
			icon: "[SKIN]/actions/add.png",
			showDisabledIcon: "[SKIN]/actions/add.png",
			click: function () {this.container.saveFwRecord();}
		});
		
		this.removeButton = isc.IButton.create({
			container: this,
			title: "Remove",
			icon: "[SKIN]/TabSet/close.png",
			showDisabledIcon: "[SKIN]/TabSet/close_Disabled.png",
			disabled: true,
			click: "this.container.deleteFwRecord();"
		});
		
		this.fwGridH=isc.HLayout.create({
			showResizeBar:false,
			width:"80%",
			height:"60%",
			layoutTopMargin:30,
			layoutLeftMargin:10,
			membersMargin:10,
			members: [this.listGrid_FwMailboxes, this.removeButton]
		});

		this.fwAddH = isc.HLayout.create({  
			showResizeBar:false,
			width:"80%",
			height:20,
			membersMargin:10,
			layoutLeftMargin:10,
			members: [this.fwForm, this.addButton]
		});
		
		this.fwTab=isc.VLayout.create({
			showResizeBar:false,
			layoutLeftMargin:15,
			membersMargin:10,
			members: [this.fwGridH, this.fwAddH,this.fwCheckForm]
		});

		this.tabset_Mailboxes=isc.TabSet.create({
			ID:"tabset_Mailboxes",
			visibility:"hidden",
			height:"70%",
			width:"100%",
			container:this,
			tabs:[
				{title:"Mailbox", pane:this.mailboxFormH, ID:"tab0"},
				{title:"Forwards", pane:this.fwTab, ID:"tab1"}
			]
		});
		this.addMember(this.enableMailH);
		this.addMember(this.tabH);
		this.addMember(this.tabset_Mailboxes);
		this.newRecord();
		
	},
	loadFwRecord: function(record) {
		this.setMailboxId(record.mailbox_id);
		fwForm.editNewRecord({mailbox_id:record.mailbox_id});
	},
	newRecord: function() {
		this.fwForm.editNewRecord({mailbox_id:listGrid_FwMailboxes.container.mailId});
	},
	setDomainId: function(domainId) {
		this.domainId = domainId;
		this.listGrid_Mailboxes.fetchData({domain_id: domainId});
		this.newButton.setDisabled(false);
		this.deleteButton.setDisabled(true);
	},
	setMailboxId: function(mailId) {
		this.mailId = mailId;
		this.listGrid_FwMailboxes.fetchData({mailbox_id: mailId});
		this.removeButton.setDisabled(true);
	},
	saveRecord: function() {
		this.valuesManager.saveData(function(dsResponse, data, dsRequest) {
			if (dsResponse.status != 0)
				return;
			if (!this.isNewRecord())
				return;
			this.setSaveOperationType("update");
		});
	},
	saveFwRecord: function() {
		
		fwForm.saveData(function(dsResponse, data, dsRequest) {
			if (dsResponse.status != 0)
				return;
			if (!this.isNewRecord())
				return;
			this.setSaveOperationType("update");
		});
	this.newRecord();
	},
	saveApplyRecord: function() {
		this.enableMail.saveData(function(dsResponse, data, dsRequest) {
			if (dsResponse.status != 0)
				return;
			if (!this.isNewRecord())
				return;
			this.setSaveOperationType("update");
		});
	},
	deleteRecord: function() {
		if (listGrid_Mailboxes.getSelectedRecord()==null) isc.say("Select a mailbox first!");
		else isc.ask("Really delete this mailbox? The associate forwards addresses will be deleted too.", function (value) {
			if (value)
			{		
				this.container.__deleteRecord();
			}
		}, {container: this});
		
	},

	__deleteRecord: function() {
		this.listGrid_Mailboxes.dataSource.removeData(this.listGrid_Mailboxes.getSelectedRecord(), { target: this, methodName: "deleteRecordCallback" });
	},

	deleteRecordCallback: function(dsResponse, data, dsRequest) {
		if (dsResponse.status != 0)
			return;
		this.newRecord();
	},
	deleteFwRecord: function() {
		
		isc.ask("Really delete?", function (value) {
			if (value)
				this.container.__deleteFwRecord();
		}, {container: this});
	},

	__deleteFwRecord: function() {
		this.listGrid_FwMailboxes.dataSource.removeData(this.listGrid_FwMailboxes.getSelectedRecord(), { target: this, methodName: "deleteFwRecordCallback" });
	},

	deleteFwRecordCallback: function(dsResponse, data, dsRequest) {
		if (dsResponse.status != 0)
			return;
		this.fwForm.editNewRecord({mailbox_id:listGrid_FwMailboxes.container.mailId});
	},
	domainId: null,
	mailId:null
	
});

isc.ClassFactory.defineClass("TabAliases", isc.VLayout);

isc.TabAliases.addProperties({
	width: "100%",
	height: "100%",
	align:"center",
	showResizeBar:false,
	initWidget: function() {
		this.Super("initWidget", arguments);
		this.listGrid_Aliases=isc.ListGrid.create({
			ID:"listGrid_Aliases",
			container:this,
			width:"100%",
			height:"100%",
			alternateRecordStyles:true,
			dataSource: isc.DS.get("aliases"),
			autoFetchData: false,
			showResizeBar: false,
			recordClick: function (viewer, record){
				this.container.deleteButton.setDisabled(false);
				this.container.aliasToForm.editNewRecord({global_mail_alias_id:record.global_mail_alias_id});
				this.container.loadToRecord(record);
				this.container.addButton.setDisabled(false);
				this.container.newButton.setDisabled(false);
				this.container.AliasTo.show();
			},
				fields: [
					{name: "domain_id",showIf:"false"},
					{name: "global_mail_alias_id",showIf:"false"},
					{name: "name", title: "Alias",required:"true",canEdit:false},
					{name: "addressalias", title: "Address", align:"center",canFilter:false,canEdit:false}
					],  
		  		autoFitData: "vertical",
		  		showFilterEditor: false,
		  		autoFitMaxRecords: 10
		});
		
		this.deleteButton = isc.IButton.create({
			container: this,
			title: "Remove",
			icon: "[SKIN]/TabSet/close.png",
			showDisabledIcon: "[SKIN]/TabSet/close_Disabled.png",
			disabled: true,
			click: "this.container.deleteRecord();"
		});
		this.aliasForm=isc.DynamicForm.create({
			ID:"aliasForm",
			container: this,
			
			dataSource: isc.DS.get("aliases"),
			fields: [
			{name: "name",type: "text", required:"true"}],
		});
		this.newButton = isc.IButton.create({
			container: this,
			title: "New",
			icon: "[SKIN]/actions/add.png",
			showDisabledIcon: false,
			click: function ()
				{	
					this.container.saveRecord();
				}
		});
		this.AliasGridH = isc.HLayout.create({
			showResizeBar:false,
			membersMargin:10,
			height:"100%",
			layoutTopMargin:30,
			members: [this.listGrid_Aliases, this.deleteButton]
		});
		this.AliasAddH = isc.HLayout.create({
			showResizeBar:false,
			membersMargin:10,
			layoutTopMargin:10,
			members: [this.aliasForm, this.newButton]
		});

		this.Alias=isc.VLayout.create({
			showResizeBar:true,
			layoutLeftMargin:30,
			width:"80%",
			height:"50%",
			members: [this.AliasGridH, this.AliasAddH]
		});

		this.listGrid_AliasTo=isc.ListGrid.create({
			ID:"listGrid_AliasTo",
			container:this,
			width:"100%",
			alternateRecordStyles:true,
			dataSource: isc.DS.get("aliasesto"),
			autoFetchData: false,
			showResizeBar: false,
			recordClick: function (viewer, record){
				this.container.removeButton.setDisabled(false);
				//this.container.aliasForm.editRecord(record);
				this.container.addButton.setDisabled(false);
			},
			fields: [
				{name: "address", align:"center"}
				],  
		  	autoFitData: "vertical",
		  	autoFitMaxRecords: 5
		});
		
		this.aliasToForm=isc.DynamicForm.create({
			ID:"aliasToForm",
			container: this,
			dataSource: isc.DS.get("aliasesto"),
			fields: [
			{name: "address", type: "text", required:"true"}]
		});

		this.addButton = isc.IButton.create({
			container: this,
			title: "Add",
			showDisabledIcon: "[SKIN]/actions/add.png",
			disabled:true,
			icon: "[SKIN]/actions/add.png",
			click: function () {this.container.saveToRecord();}
		});
		this.removeButton = isc.IButton.create({
			container: this,
			title: "Remove",
			icon: "[SKIN]/TabSet/close.png",
			showDisabledIcon: "[SKIN]/TabSet/close_Disabled.png",
			disabled: true,
			click: "this.container.deleteToRecord();"
		});
		
		this.AliasToGridH=isc.HLayout.create({
			showResizeBar:false,
			width:"80%",
			height:"50%",
			layoutLeftMargin:30,
			membersMargin:10,
			members: [this.listGrid_AliasTo, this.removeButton]
		});

		this.AliasToAddH = isc.HLayout.create({
			showResizeBar:false,
			width:"80%",
			height:"40%",
			layoutLeftMargin:30,
			layoutTopMargin:10,
			membersMargin:10,
			members: [this.aliasToForm, this.addButton]
		});
		
		this.AliasTo=isc.VLayout.create({
			showResizeBar:false,
			height:"50%",
			visibility:"hidden",
			members: [this.AliasToGridH, this.AliasToAddH]
		});

		this.addMember(this.Alias);
		this.addMember(this.AliasTo);
	},
	setDomainId: function(domainId) {
		this.domainId = domainId;
		this.listGrid_Aliases.fetchData({domain_id: domainId});
		this.newButton.setDisabled(false);
		this.deleteButton.setDisabled(true);
	},
	loadToRecord: function(record) {
		this.setAliasId(record.global_mail_alias_id);
		aliasToForm.editNewRecord(record);
	},
	newRecord: function() {
		this.alisForm.editNewRecord({domain_id:listGrid_Aliases.container.domainId});
	},
	setAliasId: function(aliasId) {
		this.aliasId = aliasId;
		this.listGrid_AliasTo.fetchData({global_mail_alias_id: aliasId});
		this.removeButton.setDisabled(true);
	},
	saveRecord: function() {
		this.aliasForm.saveData(function(dsResponse, data, dsRequest) {
			if (dsResponse.status != 0)
				return;
			if (!this.isNewRecord())
				return;
			this.setSaveOperationType("update");
		});
	this.aliasForm.editNewRecord({domain_id:listGrid_Aliases.container.domainId});
	},
	saveToRecord: function() {
		this.aliasToForm.saveData(function(dsResponse, data, dsRequest) {
			if (dsResponse.status != 0)
				return;
			if (!this.isNewRecord())
				return;
			this.setSaveOperationType("update");
		});
	this.aliasToForm.editNewRecord({global_mail_alias_id:listGrid_AliasTo.container.aliasId});
	},
	deleteRecord: function() {
		if (listGrid_Aliases.getSelectedRecord()==null) isc.say("Select a alias first!");
		else isc.ask("Really delete?", function (value) {
			if (value)
				this.container.__deleteRecord();
		}, {container: this});
	},

	__deleteRecord: function() {
		this.listGrid_Aliases.dataSource.removeData(this.listGrid_Aliases.getSelectedRecord(), { target: this, methodName: "deleteRecordCallback" });
	},

	deleteRecordCallback: function(dsResponse, data, dsRequest) {
		if (dsResponse.status != 0)
			return;
		//this.newRecord();
	},
	deleteToRecord: function() {
		
		isc.ask("Really delete?", function (value) {
			if (value)
				this.container.__deleteToRecord();
		}, {container: this});
	},

	__deleteToRecord: function() {
		this.listGrid_AliasTo.dataSource.removeData(this.listGrid_AliasTo.getSelectedRecord(), { target: this, methodName: "deleteToRecordCallback" });
	},

	deleteToRecordCallback: function(dsResponse, data, dsRequest) {
		if (dsResponse.status != 0)
			return;
		this.aliasToForm.editNewRecord({global_mail_alias_id:listGrid_AliasTo.container.aliasId});
	},
	domainId: null,
	aliasId:null
});

isc.ClassFactory.defineClass("TabFTPSett", isc.VLayout);

isc.TabFTPSett.addProperties({
	width: "100%",
	height: "100%",
	padding:30,
	align:"center",
	showResizeBar:false,
	initWidget: function() {
		this.Super("initWidget", arguments);
		this.settForm=isc.DynamicForm.create({
		    ID: "settForm",
		    dataSource: isc.DS.get("users"),
		    fields: [
			{name:"username",canEdit:false},
			{name: "password",required: true,type: "password"},
			{name: "password_confirm", title: "Confirm", type: "password", required: true, 
			 length: 20, validators: [{
			     type: "matchesField",
			     otherField: "password",
			     errorMessage: "Passwords do not match"
			 }]
			}
		    ],values:{username:"gigi"}
		});
		this.enableFtp=isc.DynamicForm.create({
			ID:"enableFtp",
			dataSource:isc.DS.get("domains"),
			fields:[{name:"enable_ftp", type:"checkbox", title:"Enable FTP Access"}]
		});
		this.saveButton = isc.IButton.create({
			container: this,
			title: "Save",
			icon: "[SKIN]/actions/save.png",
			click: function () {this.container.saveRecord();},
		});

		this.TabSett=isc.VLayout.create({
			members:[this.settForm, this.enableFtp,this.saveButton]		
		});
		this.addMember(this.TabSett);
	},
	saveRecord: function() {
		this.settForm.saveData(function(dsResponse, data, dsRequest) {
			if (dsResponse.status != 0)
				return;
			if (!this.isNewRecord())
				return;
			this.setSaveOperationType("update");
		});
		this.enableFtp.saveData(function(dsResponse, data, dsRequest) {
			if (dsResponse.status != 0)
				return;
			if (!this.isNewRecord())
				return;
			this.setSaveOperationType("update");
		});
	}
});
isc.ClassFactory.defineClass("MenuPanel", isc.VLayout);

isc.MenuPanel.addProperties({
	width: "20%",
	height: "100%",
	align:"center",
	showResizeBar:true,
	initWidget: function() {
		this.Super("initWidget", arguments);
		this.menu11=isc.Button.create({
			title:"Domains",
			align:"left",
			width:148,
			height:20,
			icon:"[SKINIMG]/SchemaViewer/complexType.gif",
			baseStyle: "myMenuButton",
			click: function() 
				{
				
				}		
		});
		this.menu12=isc.Button.create({
			title:"Databases",
			width:148,
			height:20,
			align:"left",
			icon:"[SKINIMG]/DatabaseBrowser/data.png",
			baseStyle: "myMenuButton",
			click: function() 
				{
				
				}		
		});
		this.menu13=isc.Button.create({
			title:"System",
			width:148,
			height:20,
			align:"left",
			icon:"[SKINIMG]/Window/headerIcon.png",
			baseStyle: "myMenuButton",
			click: function() 
				{
				
				}		
		});
		this.menu14=isc.Button.create({
			title:"Logout",
			width:148,
			height:20,
			align:"left",
			icon:"[SKINIMG]/Window/headerIcon.png",
			baseStyle: "myMenuButton",
			click: function() 
				{
				
				}		
		});
		this.treegrid1=isc.VLayout.create({
			ID:"treegrid1",
			width:150,
			height:80,
			//membersMargin:5,
			layoutTopMargin:10,
			layoutBottomMargin:10,
			//padding:10,
			border:"1px solid gray",
			members:[this.menu11,this.menu12,this.menu13,this.menu14]
		});
		this.menu21=isc.Button.create({
			title:"New domain",
			align:"left",
			width:148,
			height:20,
			icon:"[SKINIMG]/actions/add.png",
			baseStyle: "myMenuButton",
			click: function() 
				{
					tabWeb.hide();
					tabFTP.hide();
					tabMail.hide();
					summary.hide();
					formLayout.show();
					wizardV.hide();	
				}		
		});
		this.menu22=isc.Button.create({
			title:"Wizard",
			width:148,
			height:20,
			align:"left",
			icon:"[SKINIMG]/RichTextEditor/link_new.png",
			baseStyle: "myMenuButton",
			click: function() 
				{
					tabWeb.hide();
					tabFTP.hide();
					tabMail.hide();
					summary.hide();
					formLayout.hide();
					wizardV.show();
				}		
		});
		this.menu23=isc.Button.create({
			title:"Remove",
			width:148,
			height:20,
			align:"left",
			icon:"[SKINIMG]/actions/remove.png",
			baseStyle: "myMenuButton",
			click: function() 
				{
					tabWeb.hide();
					tabFTP.hide();
					tabMail.hide();
					formLayout.hide();
					if (listGrid.getSelectedRecord() != null) this.container.deleteRecord(); 
						else isc.say('Select a domain first!');
				}		
		});
		this.treegrid2=isc.VLayout.create({
			ID:"treegrid2",
			width:150,
			height:60,
			//membersMargin:5,
			layoutTopMargin:10,
			layoutBottomMargin:10,
			//padding:10,
			border:"1px solid gray",
			members:[this.menu21,this.menu22,this.menu23]
		});
		
		this.menu31=isc.Button.create({
			title:"Summary",
			align:"left",
			width:148,
			height:20,
			icon:"[SKINIMG]/FileBrowser/file.png",
			baseStyle: "myMenuButton",
			click: function() 
				{
					tabWeb.hide();
					tabFTP.hide();
					tabMail.hide();
					formLayout.hide();
					wizardV.hide();
					summary.show();
				}		
		});
		this.menu32=isc.Button.create({
			title:"Web",
			width:148,
			height:20,
			align:"left",
			icon:"[SKINIMG]/Window/headerIcon.png",
			baseStyle: "myMenuButton",
			click: function() 
				{
					tabWeb.show();
					tabFTP.hide();
					tabMail.hide();
					formLayout.hide();
					summary.hide();
		                        tabWeb.selectTab(0);
					wizardV.hide();
				}		
		});
		this.menu33=isc.Button.create({
			title:"FTP",
			width:148,
			height:20,
			align:"left",
			icon:"[SKINIMG]/FileBrowser/folder.png",
			baseStyle: "myMenuButton",
			click: function() 
				{
					tabWeb.hide();
					tabFTP.show();
					tabMail.hide();
					formLayout.hide();
					summary.hide();
		                        tabFTP.selectTab(0);
					wizardV.hide();
				}		
		});
		this.menu34=isc.Button.create({
			title:"Mail",
			width:148,
			height:20,
			align:"left",
			icon:"[SKINIMG]/Window/headerIcon.png",
			baseStyle: "myMenuButton",
			click: function() 
				{
					tabWeb.hide(); 
					tabFTP.hide();
					tabMail.show();
					formLayout.hide();  
					summary.hide();                                	
					tabMail.selectTab(0);
					wizardV.hide();
				}		
		});
		this.menu35=isc.Button.create({
			title:"DNS",
			width:148,
			height:20,
			align:"left",
			icon:"[SKINIMG]/Window/headerIcon.png",
			baseStyle: "myMenuButton",
			click: function() 
				{
					tabWeb.hide();
					tabFTP.hide();
					tabMail.hide();
					formLayout.hide();
					summary.hide();wizardV.hide();
				}		
		});
		this.treegrid3=isc.VLayout.create({
			ID:"treegrid3",
			width:150,
			height:100,
			//membersMargin:5,
			layoutTopMargin:10,
			layoutBottomMargin:10,
			//layoutLeftMargin:10,
			//padding:10,
			border:"1px solid gray",
			members:[this.menu31,this.menu32,this.menu33,this.menu34,this.menu35]
		});
		
		this.stack1=isc.SectionStack.create({
		   	ID: "stack1",
			container:this,
			visibilityMode: "multiple",
		    	width:	152,
			height: 400,
			align:"center",
		    	sections: [
			{title: "MENU", expanded: true,width: 152,align:"center", items: [this.treegrid1]},
			{title: "ACTIONS", expanded: true, items: [this.treegrid2]},
			{title: "d", expanded: true, items: [this.treegrid3]}
		    ]
		});
	
		this.addMember(this.stack1);

	},

	deleteRecord: function() {
		isc.ask("Really delete?", function (value) {
			if (value)
				this.container.__deleteRecord();
		}, {container: this});
	},

	__deleteRecord: function() {
		listGrid.dataSource.removeData(listGrid.getSelectedRecord(), { target: this, methodName: "deleteRecordCallback" });
	},

	deleteRecordCallback: function(dsResponse, data, dsRequest) {
		if (dsResponse.status != 0)
			return;
		stack1.hideSection(2);
	}
});
isc.ClassFactory.defineClass("PanelView", isc.HLayout);

isc.PanelView.addProperties({
	width: "100%",
	height: "100%",
	initWidget: function() {
		this.Super("initWidget", arguments);
		this.MenuPanel=isc.MenuPanel.create();
		this.TabsPanel=isc.TabsPanel.create();
		this.addMember(this.MenuPanel);
		this.addMember(this.TabsPanel);
		this.loadinit();
	},

        loadinit: function()
        {
             if (listGrid.getSelectedRecord() == null) stack1.hideSection(2); 
        }
});
isc.PanelView.create();

</script>
</body>
</html>

