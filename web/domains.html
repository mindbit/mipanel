<html>
<head>
<script>var isomorphicDir="/isomorphic/";</script>
<script src="/isomorphic/system/modules/ISC_Core.js"></script>
<script src="/isomorphic/system/modules/ISC_Foundation.js"></script>
<script src="/isomorphic/system/modules/ISC_Containers.js"></script>
<script src="/isomorphic/system/modules/ISC_Grids.js"></script>
<script src="/isomorphic/system/modules/ISC_Forms.js"></script>
<script src="/isomorphic/system/modules/ISC_DataBinding.js"></script>
<script src="/isomorphic/skins/TreeFrog/load_skin.js"></script>
</head>
<body>
<script> 
isc.RestDataSource.create({
    ID:"domain",
    dataFormat:"json",
    dataURL:"ds-domains.php",
    fields:[
        {type: "sequence", name: "domain_id", primaryKey: true},
	{name: "domain_id"},
        {title:"Domain", name:"domain", type: "text",  required: true}
    ],
    operationBindings:[
       {operationType:"fetch", dataProtocol:"postMessage"},
       {operationType:"add", dataProtocol:"postMessage"},
       {operationType:"remove", dataProtocol:"postMessage"},
       {operationType:"update", dataProtocol:"postMessage"}
    ],
}); 

isc.Label.create({
	ID:"label1",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"Settings for <b>Web</b> Tab"
});
isc.Label.create({
	ID:"label2",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"VHOSTS for <b>Web</b> Tab"
});
isc.Label.create({
	ID:"label3",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"Statistics for <b>Web</b> Tab"
});
isc.Label.create({
	ID:"label4",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"Logs for <b>Web</b> Tab"
});
isc.Label.create({
	ID:"label5",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"Settings for <b>FTP</b> Tab"
});
pane:isc.Label.create({
	ID:"label6",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"SmartAuth for <b>FTP</b> Tab"
});
isc.Label.create({
	ID:"label7",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"Logs for <b>FTP</b> Tab"
});
isc.Label.create({
	ID:"label8",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"Mailboxes for <b>Mail</b> Tab"
});
isc.Label.create({
	ID:"label9",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"Fw&Alias for <b>Mail</b> Tab"
});
isc.Label.create({
	ID:"label10",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"Logs for <b>Mail</b> Tab"
});
isc.Label.create({
	ID:"label11",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"Auto-Reply for <b>Mail</b> Tab"
});
isc.Label.create({
	ID:"label12",
	autoDraw: false,
	width:"100%",
	height:"100%",
	align:"center",
	contents:"Logs for <b>Mail</b> Tab"
});

isc.ClassFactory.defineClass("PanelView", isc.HLayout);

isc.PanelView.addProperties({
	width: "100%",
	height: "100%",
	initWidget: function() {
		this.Super("initWidget", arguments);
		/*this.listGrid = isc.ListGrid.create({ ID: "listGrid",
    		width: "100%",
		showResizeBar:true,
 		recordClick: function (viewer, record)
			{
				stack3.setSectionTitle(0,record.project);
				stack3.show();
				if (stack3.sectionIsExpanded(0)) menu3.show();
				if (stack1.sectionIsExpanded(0)) menu1.show();
				if (stack2.sectionIsExpanded(0)) menu2.show();
			},
    		 fields: [
                       {name: "project", title: "Project", type: "text"},
                       {name: "web", title: "Web", align:"center",  width:100, type:"image", canFilter:false},
                       {name: "ftp", title: "FTP", align:"center",  width:100, type:"image",canFilter:false},
                       {name: "dns", title: "DNS", align:"center",  width:100, type:"image", canFilter:false},
                       {name: "mail", title: "Mail", align:"center",  width:100, type:"image",canFilter:false}
                        ],
   		data: [
	       		{project: "AJAX Interface",web:"[SKIN]/actions/approve.png",ftp:"[SKIN]/actions/approve.png",dns:"[SKIN]/actions/approve.png",mail:"[SKIN]/actions/approve.png"},
			{project: "Simplify Backend",web:"[SKIN]/actions/remove.png",ftp:"[SKIN]/actions/remove.png",dns:"[SKIN]/actions/approve.png",mail:"[SKIN]/actions/approve.png"},
			{project: "Broaden Reach",web:"[SKIN]/actions/approve.png",ftp:"[SKIN]/actions/remove.png",dns:"[SKIN]/actions/remove.png",mail:"[SKIN]/actions/approve.png"}
    		],
		showFilterEditor: true,
		autoFitMaxRecords: 10
		});*/
		this.listGrid = isc.ListGrid.create({
			ID: "listGrid",
			container: this,
			width: "100%",
			alternateRecordStyles:true,
			dataSource: isc.DS.get("domain"),
			autoFetchData: true,
			showResizeBar: true,
			recordClick: function (viewer, record){
				stack3.setSectionTitle(0,record.project);
				stack3.show();
				if (stack3.sectionIsExpanded(0)) menu3.show();
				if (stack1.sectionIsExpanded(0)) menu1.show();
				if (stack2.sectionIsExpanded(0)) menu2.show();
			},
				fields: [
					{name: "domain", title: "Domain",required:"true"},
					/*{name: "web", title: "Web", align:"center",  width:100, type:"image", canFilter:false},
                       			{name: "ftp", title: "FTP", align:"center",  width:100, type:"image",canFilter:false},
                      			{name: "dns", title: "DNS", align:"center",  width:100, type:"image", canFilter:false},
                       			{name: "mail", title: "Mail", align:"center",  width:100, type:"image",canFilter:false}*/
					],  
		  		autoFitData: "vertical",
		  		showFilterEditor: true,
		  		autoFitMaxRecords: 10
		});
		
		this.tabWeb=isc.TabSet.create({
                        ID:"tabWeb",
			visibility:"hidden",
			container:this,
			tabs:[	
				{title:"Settings", pane:label1, ID:"settWebTab"},
				{title:"VHOSTS", pane:label2, ID:"vhostWebTab"},
				{title:"Statistics", pane:label3, ID:"statWebTab"},
				{title:"Logs", pane:label4, ID:"logsWebTab"}
			]
              	});
		this.tabMail=isc.TabSet.create({
			ID:"tabMail",
			visibility:"hidden",
			container:this,
			tabs:[
				{title:"Mailboxes", pane:label8, ID:"mailboxMailTab"},
				{title:"Forwards&Aliases", pane:label9, ID:"fwMailTab"},
				{title:"Catch-all", pane:label10, ID:"catchMailTab"},
				{title:"Auto-Reply", pane:label11, ID:"autoMailTab"},
				{title:"Logs", pane:label12, ID:"logsMailTab"}
			]
		});

		this.tabFTP=isc.TabSet.create({
			ID:"tabFTP",
			visibility:"hidden",
			container:this,
			tabs:[
				{title:"Settings", pane:label5, ID:"settFTPTab"},
				{title:"SmartAuth", pane:label6, ID:"smartFTPTab"},
				{title:"Logs", pane:label7, ID:"logsFTPTab"}
			]
		});

		this.menu1= isc.Menu.create({ 
                        ID:"menu1",
			cellHeight:20,
			container:this,
			width:150,
			height:100,
		 	showShadow: false,
			align:"center",
			autoDraw:true,
			data:[
				{
				title:"Domains",
				icon:"/imgs/complexType.gif",
			    	click:function () 
					{
						if (stack1.sectionIsExpanded(0)) menu1.show(); 
						if (stack2.sectionIsExpanded(0)) menu2.show(); 
						if (listGrid.getSelectedRecord() != null && stack3.sectionIsExpanded(0))  menu3.show();
						/*this.menuSH();*/
						tabWeb.hide();
						tabFTP.hide();
						tabMail.hide();
						dynamForm.hide();
					}
				},
		   
				{
				title:"Databases",
				icon:"/imgs/data.png",
				click: function () 
					{
						if (stack1.sectionIsExpanded(0)) menu1.show(); 
						if (stack2.sectionIsExpanded(0)) menu2.show(); 
						if (listGrid.getSelectedRecord() != null && stack3.sectionIsExpanded(0))  menu3.show();
						tabWeb.hide();
						tabFTP.hide();
						tabMail.hide();
						dynamForm.hide();
					}
				},
				{
				title:"System",
				icon:"/imgs/gears.png",
				click: function () 
					{
						if (stack1.sectionIsExpanded(0)) menu1.show(); 
						if (stack2.sectionIsExpanded(0)) menu2.show(); 
						if (listGrid.getSelectedRecord() != null && stack3.sectionIsExpanded(0))  menu3.show();
						tabWeb.hide();
						tabFTP.hide();
						tabMail.hide();
						dynamForm.hide();
					}
				},
				{
				title:"Logout",
				icon:"/imgs/cube_yellow.png",
				click: function () 
					{
						if (stack1.sectionIsExpanded(0)) menu1.show(); 
						if (stack2.sectionIsExpanded(0)) menu2.show(); 
						if (listGrid.getSelectedRecord() != null && stack3.sectionIsExpanded(0))  menu3.show();
						tabWeb.hide();
						tabFTP.hide();
						tabMail.hide();
						dynamForm.hide();
					}
				}
			]  
		  });

		this.menu2= isc.Menu.create({ 
                        ID:"menu2",
			cellHeight:20,
			container:this,
			width:150,
			height:75,
			showShadow: false,
			align:"center",
			autoDraw:true,
			data:[
				{
				title:"New Domain",
				icon:"/imgs/add.png",
				click:function () 
					{ 
						if (stack1.sectionIsExpanded(0)) menu1.show();  
						if (stack2.sectionIsExpanded(0))  menu2.show(); 
						if (listGrid.getSelectedRecord() != null && stack3.sectionIsExpanded(0))  menu3.show();
						tabWeb.hide();
						tabFTP.hide();
						tabMail.hide();
						dynamForm.show();
					}
				},
				{title:"Wizard",
				icon:"/imgs/cube_blue.png",
				click:function () 
					{ 
						if (stack1.sectionIsExpanded(0)) menu1.show();  
						if (stack2.sectionIsExpanded(0))  menu2.show();  
						if (listGrid.getSelectedRecord() != null && stack3.sectionIsExpanded(0)) menu3.show();
						tabWeb.hide();
						tabFTP.hide();
						tabMail.hide();
						dynamForm.hide();
					}
				},
				{title:"Remove",
				icon:"/imgs/remove.png",
				click:function () 
					{ 
						if (stack1.sectionIsExpanded(0)) menu1.show();  
						if (stack2.sectionIsExpanded(0))  menu2.show();  
						if (listGrid.getSelectedRecord() != null && stack3.sectionIsExpanded(0)) menu3.show();
						tabWeb.hide();
						tabFTP.hide();
						tabMail.hide();
						dynamForm.hide();
					}
				}
			]  
		 });

		this.menu3= isc.Menu.create({ 
                        ID:"menu3",
			cellHeight:20,
			container:this,
			width:150,
			height:125,
			visibility:"hidden",
			showShadow: false,
			autoDraw:true,
			align:"center",
                    
			data:[
				{
				title:"Summary",
				icon:"/imgs/file.png",
				click: function ()
					{
					    	if (stack1.sectionIsExpanded(0)) menu1.show();  
					     	if (stack2.sectionIsExpanded(0))  menu2.show();  
					     	menu3.show();
						tabWeb.hide();
						tabFTP.hide();
						tabMail.hide();
						dynamForm.hide();
					}
				},
				{
				title:"Web",
				icon:"/imgs/cube_yellow.png",
				click:function ()
                                	{ 
						if (stack1.sectionIsExpanded(0)) menu1.show();  
						if (stack2.sectionIsExpanded(0))  menu2.show();  
						menu3.show();
						tabWeb.show();
						tabFTP.hide();
						tabMail.hide();
						dynamForm.hide();
		                                tabWeb.selectTab(0);
                                	}
				},
			       	{
				title:"FTP",
				icon:"/imgs/folder_closed.png",
				click:function ()
                                     	{
		                                if (stack1.sectionIsExpanded(0)) menu1.show();  
						if (stack2.sectionIsExpanded(0))  menu2.show();  
						menu3.show();
						tabWeb.hide();
						tabFTP.show();
						tabMail.hide();
						dynamForm.hide();
		                                tabFTP.selectTab(0);
                                        }
				},
				{
				title:"Mail",
				icon:"/imgs/cube_green.png",
				click:function ()
                                        { 
						if (stack1.sectionIsExpanded(0)) menu1.show();  
						if (stack2.sectionIsExpanded(0))  menu2.show();  
						menu3.show();  
						tabFTP.hide();
						tabMail.show();
						dynamForm.hide();                                  	
						tabMail.selectTab(0);
                                        }
				},
				{
				title:"DNS",
				icon:"/imgs/cube_blue.png",
				click: function ()
					{
					     	if (stack1.sectionIsExpanded(0)) menu1.show();  
					     	if (stack2.sectionIsExpanded(0))  menu2.show();  
					     	menu3.show();
						tabWeb.hide();
						tabFTP.hide();
						tabMail.hide();
						dynamForm.hide();
					}
			       	}
			] 
		  });
		
		this.dynamForm=isc.DynamicForm.create({
			//ID:"dynamForm",
			//visibility:"hidden",
			container: this,
			autoDraw: false,
			height: 48,
		       	padding:4,
			fields: [
			{name: "name", type: "text", title: "Name",required:"true"}
			]
		});
		
		this.saveButton = isc.IButton.create({
			container: this,
			title: "Save",
			icon: "[SKIN]/actions/save.png",
			click: "this.container.saveRecord()"
		});

		this.valuesManager = isc.ValuesManager.create({
			container: this,
			dataSource: isc.DS.get("domain"),
			members: [
				this.dynamForm
			]
		});
		this.layh=isc.HLayout.create({
			ID:"layh",
			width:"100%",
			height:"70%",
			border:"1px solid gray",
			members: [this.tabWeb,this.tabMail, this.tabFTP,this.dynamForm, this.saveButton]
		});		

		this.stack1=isc.SectionStack.create({
		   	ID: "stack1",
			visibilityMode: "multiple",
		    	width:	152,
			height: 150,
		    	sections: [
			{title: "MENU", expanded: true,width: 152,align:"center", items: [this.menu1],
				click: function (){
					     if (stack2.sectionIsExpanded(0)) menu2.show(); 
					     if (listGrid.getSelectedRecord() != null && stack3.sectionIsExpanded(0)) menu3.show();}}
		    ]
		});
		this.stack2=isc.SectionStack.create({
		    	ID: "stack2",
		    	visibilityMode: "multiple",
		    	width: 152, 
			height:130,
		    	sections: [
			{title: "ACTIONS", expanded: true, items: [this.menu2],
				click: function (){
					     if (stack1.sectionIsExpanded(0)) menu1.show(); 
					     if (listGrid.getSelectedRecord() != null && stack3.sectionIsExpanded(0)) menu3.show();}}
		    ]
		});

		this.stack3=isc.SectionStack.create({
		    	ID: "stack3",
		    	visibilityMode: "multiple",
		    	width: 152, height:175,
		    	sections: [
			{title: "d", expanded: true, items: [this.menu3],
				click: function (){
					      if (stack1.sectionIsExpanded(0)) menu1.show(); 
					      if (stack2.sectionIsExpanded(0)) menu2.show();}}
		    ]
		});
		
		this.TabsPanel = isc.VLayout.create({
                        ID:"TabsPanel",
			members: [this.listGrid, this.layh]
		});
		
		this.MenuPanel = isc.VLayout.create({
                        ID:"MenuPanel",
			width:"20%",
			showResizeBar:true,
			align: "center",
			members: [this.stack1,this.stack2,this.stack3]
		});
		this.menu1.show();
		this.menu2.show();
		this.addMember(this.MenuPanel);
		this.addMember(this.TabsPanel);
		this.loadinit();
	},

        loadinit: function()
        {
             if (this.listGrid.getSelectedRecord() == null) this.stack3.hide(); 
        },

	newRecord: function() {
		this.valuesManager.editNewRecord();
	},

	saveRecord: function() {
		this.valuesManager.saveData(function(dsResponse, data, dsRequest) {
			if (dsResponse.status != 0)
				return;
			if (!this.isNewRecord())
				return;
			this.setSaveOperationType("update"); 
		});
	},

	deleteRecord: function() {
		isc.ask("Really delete?", function (value) {
			if (value)
				this.container.__deleteRecord();
		}, {container: this});
	},

	__deleteRecord: function() {
		this.valuesManager.dataSource.removeData(this.valuesManager.getValues(), { target: this, methodName: "deleteRecordCallback" });
	},

	deleteRecordCallback: function(dsResponse, data, dsRequest) {
		if (dsResponse.status != 0)
			return;
		this.newRecord();
	}
});
isc.PanelView.create();

</script>
</body>
</html>
